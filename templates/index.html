<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Company Radar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
  /* Make links in the generated list stand out */
  #ul-container a { color: #2563eb; text-decoration: underline; }
  #ul-container a:visited { color: #7c3aed; }
  #ul-container a:hover { text-decoration: underline; }
  </style>

</head>
<body class="bg-slate-50 text-slate-900">
  <!-- Header -->
  <header class="bg-gradient-to-r from-indigo-600 to-blue-500 text-white">
    <div class="max-w-4xl mx-auto px-4 py-8">
      <h1 class="text-3xl font-semibold">Company Radar</h1>
      <p class="mt-2 text-white/90">High-level, analyst-style summaries from the past week’s news.</p>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-4xl mx-auto px-4 py-8">
    <!-- Form Card -->
    <div class="bg-white rounded-2xl shadow p-6">
      <form id="radar-form" method="post" action="/generate" class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1">Keyword</label>
          <input name="keyword" value="{{ keyword or '' }}" placeholder="AI Startup"
                 class="w-full rounded-xl border border-slate-200 p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
          <p class="text-xs text-slate-500 mt-1">Try: “AI Startup”, “semiconductors”, “robotics startup”, “genomics”.</p>
        </div>

        <details class="rounded-xl border border-slate-200 p-4">
          <summary class="cursor-pointer text-sm font-medium">Advanced options</summary>
          <div class="grid grid-cols-2 gap-4 mt-4">
            <div>
              <label class="block text-sm font-medium mb-1">Pages (server-side)</label>
              <input name="pages" type="number" min="1" max="5" value="{{ meta.pages if meta else '' }}" placeholder="2"
                    class="w-full rounded-xl border border-slate-200 p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>
            <div>
              <label class="block text-sm font-medium mb-1">Results per page</label>
              <input name="num" type="number" min="1" max="100" value="{{ meta.num if meta else '' }}" placeholder="40"
                    class="w-full rounded-xl border border-slate-200 p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>
          </div>
        </details>

        <div class="flex items-center gap-3">
          <button id="go-btn" type="submit"
                  class="inline-flex items-center justify-center rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 font-medium transition">
            <span id="go-text">Generate</span>
            <svg id="spinner" class="ml-2 hidden animate-spin" width="18" height="18" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="9" stroke="white" stroke-width="3" opacity=".25"/>
              <path d="M21 12a9 9 0 0 1-9 9" stroke="white" stroke-width="3"/>
            </svg>
          </button>
          <span class="text-xs text-slate-500"> It usually takes 60 to 70 seconds.</span>
        </div>
      </form>
    </div>

    <!-- Error -->
    {% if error %}
      <div class="mt-6 bg-rose-50 border border-rose-200 text-rose-800 rounded-xl p-4">
        <div class="font-medium">Error</div>
        <div class="text-sm mt-1 break-words">{{ error }}</div>
      </div>
    {% endif %}

    <!-- Results -->
    {% if ul_fragment %}
      <div id="results" class="mt-6 bg-white rounded-2xl shadow p-6">
        <div class="flex flex-wrap items-center gap-3 text-sm text-slate-600">
          <div><span class="font-medium">Query:</span> {{ meta.keyword if meta else keyword }}</div>
          {% if meta %}
            <div>• <span class="font-medium">Generated:</span> {{ meta.generated_at }}</div>
            <div>• <span class="font-medium">Items scanned:</span> {{ meta.count }}</div>
            <div>• <span class="font-medium">Runtime:</span> {{ meta.duration_sec }}s</div>
          {% endif %}
          <div class="ml-auto flex items-center gap-2">
            <button id="copy-btn" class="text-indigo-600 hover:underline text-sm">Copy list</button>
            <button id="newtab-btn" class="text-indigo-600 hover:underline text-sm">Open in new tab</button>
          </div>
        </div>

        <div id="ul-container" class="prose prose-slate max-w-none mt-4">
          {{ ul_fragment }}
        </div>
      </div>
    {% endif %}
  </main>

  <footer class="max-w-4xl mx-auto px-4 pb-10 text-slate-500 text-xs">
    <div class="mt-8">Company Radar is a toy built by G. Contact G for any questions if you know how to contact him.</div>
  </footer>

  <script>
    // Loading state
    const form = document.getElementById('radar-form');
    const goBtn = document.getElementById('go-btn');
    const goText = document.getElementById('go-text');
    const spinner = document.getElementById('spinner');
    if (form) {
      form.addEventListener('submit', () => {
        goBtn.disabled = true;
        spinner.classList.remove('hidden');
        goText.textContent = 'Working…';
      });
    }

    // Copy list (as plain text)
    const copyBtn = document.getElementById('copy-btn');
    if (copyBtn) {
      copyBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        const ul = document.querySelector('#ul-container ul');
        if (!ul) return;
        const text = Array.from(ul.querySelectorAll('li')).map(li => li.innerText).join('\n');
        try {
          await navigator.clipboard.writeText(text);
          copyBtn.textContent = 'Copied!';
          setTimeout(() => copyBtn.textContent = 'Copy list', 1500);
        } catch {}
      });
    }

    // Open results in new tab (wrap UL in a minimal HTML)
    const newBtn = document.getElementById('newtab-btn');
    if (newBtn) {
      newBtn.addEventListener('click', (e) => {
        e.preventDefault();
        const ul = document.querySelector('#ul-container').innerHTML || '';
        const html = `
          <!doctype html><html><head><meta charset="utf-8">
          <title>Company Radar</title>
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
          </head><body style="font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding:24px; max-width:820px; margin:0 auto;">
          <h1>Company Radar</h1>
          <div>${ul}</div>
          </body></html>`;
        const w = window.open('', '_blank');
        if (w) { w.document.write(html); w.document.close(); }
      });
    }

    // Auto-scroll to results
    const results = document.getElementById('results');
    if (results) {
      results.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  </script>
</body>
</html>
